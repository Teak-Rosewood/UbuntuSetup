# Building on tenorrt base container
FROM nvcr.io/nvidia/tensorrt:22.12-py3

LABEL maintainer "Saatwik Vasishtha  <saatwik.vasishtha@gmail.com>"

# Setting up tensorrt examples
RUN /opt/tensorrt/python/python_setup.sh

# Seting up general installations
RUN apt-get update && apt-get install -y --no-install-recommends \
	curl \
	protobuf-compiler \
	geany \
	libprotoc-dev \
	python3-tk \
	eog \
	gedit \
	build-essential \
	cmake \
	git \
	wget \
	unzip \
	yasm \
	pkg-config \
	libswscale-dev \
	libtbb2 \
	libtbb-dev \
	libjpeg-dev \
	libpng-dev \
	libtiff-dev \
	libavformat-dev \
	libpq-dev \
	&& rm -rf /var/lib/apt/lists/* 

# pip installations
RUN pip3 install numpy\
	torch \
	torchvision \
	torchaudio \
	onnx\
	pycuda\
	Pillow\
	wget\
	matplotlib

# setting working direcrory to root
WORKDIR /

# Installing ROS Noetic 
RUN sh -c 'echo "deb http://packages.ros.org/ros/ubuntu focal main" > /etc/apt/sources.list.d/ros-latest.list' && \
	curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | apt-key add - && \
	apt-get update && apt-get install -y --no-install-recommends ros-noetic-ros-base \
	python3-rosdep \
	python3-rosinstall \
	python3-rosinstall-generator \
	python3-wstool \
	build-essential &&\
	echo "source /opt/ros/noetic/setup.bash" >> ~/.bashrc && \
	source ~/.bashrc && \
	rosdep init && \
	rosdep update
	
# Installing torch2trt
RUN git clone https://github.com/NVIDIA-AI-IOT/torch2trt && \
	cd torch2trt/scripts && \
	bash build_contrib.sh  

# Installing OpenCV
RUN apt-get update -y || true && \
	DEBIAN_FRONTEND=noninteractive apt-get install -y tzdata libx11-dev && \
	apt-get install -y --no-install-recommends libopencv-dev && \
    rm -rf /var/lib/apt/lists/* && apt autoremove && apt clean

# settin up worspace 
WORKDIR /workspace

